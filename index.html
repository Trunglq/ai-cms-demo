
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI CMS Demo</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background-color: #f8f9fa; padding: 20px; }
        .main-content { flex-grow: 1; padding: 20px; }
        .list-group-item { cursor: pointer; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h4>Menu Tính Năng</h4>
        <div class="list-group">
            <a class="list-group-item list-group-item-action" data-feature="ai-write">AI viết bài tự động</a>
            <a class="list-group-item list-group-item-action" data-feature="spell-check">Kiểm tra lỗi chính tả</a>
            <a class="list-group-item list-group-item-action" data-feature="hot-topics">Gợi ý chủ đề HOT</a>
            <a class="list-group-item list-group-item-action" data-feature="tts">Text to Speech</a>
            <a class="list-group-item list-group-item-action" data-feature="stt">Speech to Text</a>
            <a class="list-group-item list-group-item-action" data-feature="translate-en-vi">Dịch Anh sang Việt</a>
            <a class="list-group-item list-group-item-action" data-feature="translate-vi-en">Dịch Việt sang Anh</a>
            <a class="list-group-item list-group-item-action" data-feature="publish">Xuất bản đa nền tảng</a>
            <a class="list-group-item list-group-item-action" data-feature="score-article">Chấm điểm bài báo</a>
            <a class="list-group-item list-group-item-action" data-feature="image-manage">Quản lý ảnh bằng AI</a>
        </div>
    </div>
    <div class="main-content" id="feature-content">
        <h2>Chào mừng đến với AI CMS Demo</h2>
        <p>Chọn một tính năng từ menu bên trái để bắt đầu.</p>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // For local testing only: Paste your OpenAI key here. Remove or leave empty for production (uses serverless).
        const LOCAL_OPENAI_KEY = ''; // Paste 'sk-proj-...' here for local test. Do not commit!

        document.querySelectorAll('.list-group-item').forEach(item => {
            item.addEventListener('click', async function() {
                const feature = this.getAttribute('data-feature');
                const content = document.getElementById('feature-content');
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

                if (feature === 'translate-en-vi' || feature === 'translate-vi-en') {
                    const fromLang = feature === 'translate-en-vi' ? 'Anh' : 'Việt';
                    const toLang = feature === 'translate-en-vi' ? 'Việt' : 'Anh';
                    const direction = feature === 'translate-en-vi' ? 'en-vi' : 'vi-en';
                    const inputLabel = `Nhập văn bản tiếng ${fromLang}:`;
                    const outputLabel = `Kết quả dịch (tiếng ${toLang}):`;

                    content.innerHTML = `
                        <h2>Dịch ${fromLang} sang ${toLang}</h2>
                        <div class="mb-3">
                            <label for="inputText" class="form-label">${inputLabel}</label>
                            <textarea class="form-control" id="inputText" rows="5"></textarea>
                        </div>
                        <button id="translateBtn" class="btn btn-primary">Dịch</button>
                        <div class="mt-3">
                            <label class="form-label">${outputLabel}</label>
                            <div id="outputText" class="border p-3 bg-light"></div>
                        </div>
                    `;

                    document.getElementById('translateBtn').addEventListener('click', async () => {
                        const input = document.getElementById('inputText').value;
                        if (!input) return alert('Vui lòng nhập văn bản!');

                        try {
                            let response;
                            if (isLocal && LOCAL_OPENAI_KEY) {
                                // Local direct call for testing
                                response = await fetch('https://api.openai.com/v1/chat/completions', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Authorization': `Bearer ${LOCAL_OPENAI_KEY}`
                                    },
                                    body: JSON.stringify({
                                        model: 'gpt-3.5-turbo',
                                        messages: [{ role: 'user', content: `Dịch văn bản sau từ tiếng ${fromLang} sang tiếng ${toLang}: ${input}` }]
                                    })
                                });
                            } else {
                                // Production: Call serverless endpoint
                                response = await fetch('/api/translate', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ text: input, direction })
                                });
                            }

                            if (!response.ok) throw new Error('Error: ' + response.statusText);
                            const data = await response.json();
                            document.getElementById('outputText').innerText = isLocal ? data.choices[0].message.content : data.translatedText;
                        } catch (error) {
                            console.error(error);
                            alert('Lỗi khi gọi API: ' + error.message + ' (Nếu local, kiểm tra key và mạng)');
                        }
                    });
                } else if (feature === 'spell-check') {
                    content.innerHTML = `
                        <h2>Kiểm tra lỗi chính tả</h2>
                        <div class="mb-3">
                            <label for="inputText" class="form-label">Nhập văn bản cần kiểm tra:</label>
                            <textarea class="form-control" id="inputText" rows="5"></textarea>
                        </div>
                        <select id="languageSelect" class="form-select mb-3">
                            <option value="vi">Tiếng Việt</option>
                            <option value="en">Tiếng Anh</option>
                        </select>
                        <button id="checkBtn" class="btn btn-primary">Kiểm tra</button>
                        <div class="mt-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Văn bản gốc:</label>
                                    <div id="originalText" class="border p-3 bg-light" style="min-height: 100px;"></div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Văn bản đã sửa:</label>
                                    <div id="correctedText" class="border p-3 bg-light" style="min-height: 100px;"></div>
                                </div>
                            </div>
                            <div class="mt-3" id="changesSection" style="display: none;">
                                <label class="form-label">Các thay đổi đã thực hiện:</label>
                                <div id="changesList" class="border p-3 bg-info bg-opacity-10"></div>
                            </div>
                        </div>
                    `;

                    document.getElementById('checkBtn').addEventListener('click', async () => {
                        const input = document.getElementById('inputText').value;
                        const language = document.getElementById('languageSelect').value;
                        if (!input) return alert('Vui lòng nhập văn bản!');

                        try {
                            let response;
                            if (isLocal && LOCAL_OPENAI_KEY) {
                                // Local direct call
                                const prompt = `Kiểm tra và sửa lỗi chính tả, ngữ pháp trong văn bản tiếng ${language === 'vi' ? 'Việt' : 'Anh'} theo chuẩn báo chí. Trả về JSON với format: {"original": "văn bản gốc", "corrected": "văn bản đã sửa", "changes": [{"from": "cũ", "to": "mới", "reason": "lý do"}]}. Văn bản: ${input}`;
                                response = await fetch('https://api.openai.com/v1/chat/completions', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Authorization': `Bearer ${LOCAL_OPENAI_KEY}`
                                    },
                                    body: JSON.stringify({
                                        model: 'gpt-3.5-turbo',
                                        messages: [{ role: 'user', content: prompt }],
                                        response_format: { type: "json_object" }
                                    })
                                });
                            } else {
                                // Production call
                                response = await fetch('/api/spellcheck', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ text: input, language })
                                });
                            }

                            if (!response.ok) throw new Error('Error: ' + response.statusText);
                            const data = await response.json();
                            
                            let result;
                            if (isLocal) {
                                try {
                                    result = JSON.parse(data.choices[0].message.content);
                                } catch {
                                    result = { original: input, corrected: data.choices[0].message.content, changes: [] };
                                }
                            } else {
                                result = data;
                            }

                            // Function to highlight differences
                            function highlightChanges(original, corrected, changes) {
                                let highlightedOriginal = original;
                                let highlightedCorrected = corrected;
                                
                                if (changes && changes.length > 0) {
                                    changes.forEach(change => {
                                        if (change.from && change.to) {
                                            // Highlight in original (red background for errors)
                                            highlightedOriginal = highlightedOriginal.replace(
                                                new RegExp(escapeRegex(change.from), 'g'),
                                                `<span style="background-color: #ffebee; text-decoration: line-through;">${change.from}</span>`
                                            );
                                            // Highlight in corrected (green background for corrections)
                                            highlightedCorrected = highlightedCorrected.replace(
                                                new RegExp(escapeRegex(change.to), 'g'),
                                                `<span style="background-color: #e8f5e8; font-weight: bold;">${change.to}</span>`
                                            );
                                        }
                                    });
                                }
                                
                                return { highlightedOriginal, highlightedCorrected };
                            }

                            function escapeRegex(string) {
                                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            }

                            const { highlightedOriginal, highlightedCorrected } = highlightChanges(
                                result.original, result.corrected, result.changes
                            );

                            document.getElementById('originalText').innerHTML = highlightedOriginal;
                            document.getElementById('correctedText').innerHTML = highlightedCorrected;

                            // Show changes list
                            if (result.changes && result.changes.length > 0) {
                                const changesList = document.getElementById('changesList');
                                const changesHtml = result.changes.map((change, index) => `
                                    <div class="mb-2">
                                        <strong>${index + 1}.</strong> 
                                        <span class="text-danger">"${change.from}"</span> → 
                                        <span class="text-success">"${change.to}"</span>
                                        <br><small class="text-muted">Lý do: ${change.reason}</small>
                                    </div>
                                `).join('');
                                changesList.innerHTML = changesHtml;
                                document.getElementById('changesSection').style.display = 'block';
                            } else {
                                document.getElementById('changesSection').style.display = 'none';
                            }
                        } catch (error) {
                            console.error(error);
                            alert('Lỗi khi kiểm tra: ' + error.message);
                        }
                    });
                } else {
                    content.innerHTML = `<h2>${this.textContent}</h2><p>Đang phát triển tính năng: ${feature}. Nội dung sẽ được thêm sau.</p>`;
                }
            });
        });
    </script>
</body>
</html> 